# 作業記録 2026-02-14

## 実施概要
- MVP全体を納品向けに再整理
- テスト失敗要因の除去
- ルーター/サービス層の重複削減
- 運用投稿APIの項目拡張
- ドキュメント/環境定義の更新

## 実装変更
- `app/main.py`
  - `on_event` 依存を廃止し `lifespan` へ統一
  - 起動時ブートストラップ投稿とWSLキューワーカー起動を整理
- `app/services/persistence.py` 追加
  - `save_and_refresh` を共通化
- `app/services/{posts,accounts,scenes,system_posts}.py`
  - 保存処理の重複削除
- `app/routers/pages.py`
  - 画面コンテキスト組み立てを関数化
  - フォーム投稿時の `error_summary` 取りこぼし修正
- `app/routers/api_system.py`
  - 運用投稿フォーマットに合わせて受け付け項目を拡張
- `app/routers/api_posts.py`
  - 非推奨 `utcnow` を置換
- `app/static/js/editor.js`
  - 構文破損修正
  - シーン読込API呼び出し修正
  - 進捗バー選択除外
- `start_agents.bat`
  - 既定ホストを `127.0.0.1` へ変更
- `tests/test_api.py`
  - テストクライアント初期化を共通化
  - SQLite in-memory共有のため `StaticPool` を採用
- `tests/test_wsl_queue.py`
  - tmp_path依存を排除しローカル一時ファイルへ変更
- `pyproject.toml`
  - version `1.0.0`
  - pytest addopts (`-p no:cacheprovider`)

## 検証結果
- `pytest` 実行結果: `6 passed`

## 備考
- 環境依存で `.pytest_cache` 相当の一時パス作成に権限問題が出るため、cacheproviderを無効化
